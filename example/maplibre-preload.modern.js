var t=Math.PI/180,e=180/Math.PI;function n(t){var e=r(t[0]+1,t[2]);return[r(t[0],t[2]),i(t[1]+1,t[2]),e,i(t[1],t[2])]}function r(t,e){return t/Math.pow(2,e)*360-180}function i(t,n){var r=Math.PI-2*Math.PI*t/Math.pow(2,n);return e*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))}function o(t,e,n){var r=l(t,e,n);return r[0]=Math.floor(r[0]),r[1]=Math.floor(r[1]),r}function s(t){return[[2*t[0],2*t[1],t[2]+1],[2*t[0]+1,2*t[1],t[2]+1],[2*t[0]+1,2*t[1]+1,t[2]+1],[2*t[0],2*t[1]+1,t[2]+1]]}function a(t){return[t[0]>>1,t[1]>>1,t[2]-1]}function c(t){return s(a(t))}function h(t,e){for(var n=0;n<t.length;n++)if(u(t[n],e))return!0;return!1}function u(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function l(e,n,r){var i=Math.sin(n*t),o=Math.pow(2,r),s=o*(e/360+.5);return(s%=o)<0&&(s+=o),[s,o*(.5-.25*Math.log((1+i)/(1-i))/Math.PI),r]}var p={tileToGeoJSON:function(t){var e=n(t);return{type:"Polygon",coordinates:[[[e[0],e[3]],[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]]]}},tileToBBOX:n,getChildren:s,getParent:a,getSiblings:c,hasTile:h,hasSiblings:function(t,e){for(var n=c(t),r=0;r<n.length;r++)if(!h(e,n[r]))return!1;return!0},tilesEqual:u,tileToQuadkey:function(t){for(var e="",n=t[2];n>0;n--){var r=0,i=1<<n-1;0!=(t[0]&i)&&r++,0!=(t[1]&i)&&(r+=2),e+=r.toString()}return e},quadkeyToTile:function(t){for(var e=0,n=0,r=t.length,i=r;i>0;i--){var o=1<<i-1,s=+t[r-i];1===s&&(e|=o),2===s&&(n|=o),3===s&&(e|=o,n|=o)}return[e,n,r]},pointToTile:o,bboxToTile:function(t){var e=o(t[0],t[1],32),n=o(t[2],t[3],32),r=[e[0],e[1],n[0],n[1]],i=function(t){for(var e=0;e<28;e++){var n=1<<32-(e+1);if((t[0]&n)!=(t[2]&n)||(t[1]&n)!=(t[3]&n))return e}return 28}(r);return 0===i?[0,0,0]:[r[0]>>>32-i,r[1]>>>32-i,i]},pointToTileFraction:l},f=Object.assign(Object.create(null),p,{default:p});function m(t){var e={exports:{}};return t(e,e.exports),e.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var g=m(function(t,e){var n=function(){var t={},e=Math.PI/180,n=180/Math.PI,r=6378137,i=20037508.342789244;function o(t){return Number(t)===t&&t%1!=0}function s(e){if(this.size=(e=e||{}).size||256,!t[this.size]){var n=this.size,r=t[this.size]={};r.Bc=[],r.Cc=[],r.zc=[],r.Ac=[];for(var i=0;i<30;i++)r.Bc.push(n/360),r.Cc.push(n/(2*Math.PI)),r.zc.push(n/2),r.Ac.push(n),n*=2}this.Bc=t[this.size].Bc,this.Cc=t[this.size].Cc,this.zc=t[this.size].zc,this.Ac=t[this.size].Ac}return s.prototype.px=function(t,n){if(o(n)){var r=this.size*Math.pow(2,n),i=r/2,s=r/360,a=r/(2*Math.PI),c=r,h=Math.min(Math.max(Math.sin(e*t[1]),-.9999),.9999);return(u=i+t[0]*s)>c&&(u=c),(l=i+.5*Math.log((1+h)/(1-h))*-a)>c&&(l=c),[u,l]}i=this.zc[n],h=Math.min(Math.max(Math.sin(e*t[1]),-.9999),.9999);var u=Math.round(i+t[0]*this.Bc[n]),l=Math.round(i+.5*Math.log((1+h)/(1-h))*-this.Cc[n]);return u>this.Ac[n]&&(u=this.Ac[n]),l>this.Ac[n]&&(l=this.Ac[n]),[u,l]},s.prototype.ll=function(t,e){if(o(e)){var r=this.size*Math.pow(2,e),i=r/(2*Math.PI),s=r/2,a=(t[1]-s)/-i;return[(t[0]-s)/(r/360),n*(2*Math.atan(Math.exp(a))-.5*Math.PI)]}return a=(t[1]-this.zc[e])/-this.Cc[e],[(t[0]-this.zc[e])/this.Bc[e],n*(2*Math.atan(Math.exp(a))-.5*Math.PI)]},s.prototype.bbox=function(t,e,n,r,i){r&&(e=Math.pow(2,n)-1-e);var o=[(+t+1)*this.size,e*this.size],s=this.ll([t*this.size,(+e+1)*this.size],n).concat(this.ll(o,n));return"900913"===i?this.convert(s,"900913"):s},s.prototype.xyz=function(t,e,n,r){"900913"===r&&(t=this.convert(t,"WGS84"));var i=[t[2],t[3]],o=this.px([t[0],t[1]],e),s=this.px(i,e),a=[Math.floor(o[0]/this.size),Math.floor((s[0]-1)/this.size)],c=[Math.floor(s[1]/this.size),Math.floor((o[1]-1)/this.size)],h={minX:Math.min.apply(Math,a)<0?0:Math.min.apply(Math,a),minY:Math.min.apply(Math,c)<0?0:Math.min.apply(Math,c),maxX:Math.max.apply(Math,a),maxY:Math.max.apply(Math,c)};if(n){var u={minY:Math.pow(2,e)-1-h.maxY,maxY:Math.pow(2,e)-1-h.minY};h.minY=u.minY,h.maxY=u.maxY}return h},s.prototype.convert=function(t,e){return"900913"===e?this.forward(t.slice(0,2)).concat(this.forward(t.slice(2,4))):this.inverse(t.slice(0,2)).concat(this.inverse(t.slice(2,4)))},s.prototype.forward=function(t){var n=[r*t[0]*e,r*Math.log(Math.tan(.25*Math.PI+.5*t[1]*e))];return n[0]>i&&(n[0]=i),n[0]<-i&&(n[0]=-i),n[1]>i&&(n[1]=i),n[1]<-i&&(n[1]=-i),n},s.prototype.inverse=function(t){return[t[0]*n/r,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/r)))*n]},s}();t.exports=n}),d={},v=function(t,e,n,r){void 0!==t.lon&&(t=[t.lon,t.lat]);var i=function(t){return d[t=t||256]||(d[t]=new g({size:t})),d[t]}(r),o=i.px(t,e),s=i.ll([o[0]-n[0]/2,o[1]-n[1]/2],e),a=i.ll([o[0]+n[0]/2,o[1]+n[1]/2],e);return[s[0],a[1],a[0],s[1]]},y=m(function(t,e){t.exports=function(){function t(t){return t.charAt(0).toUpperCase()+t.substring(1)}function e(t){return function(){return this[t]}}var n=["isConstructor","isEval","isNative","isToplevel"],r=["columnNumber","lineNumber"],i=["fileName","functionName","source"],o=n.concat(r,i,["args"],["evalOrigin"]);function s(e){if(e)for(var n=0;n<o.length;n++)void 0!==e[o[n]]&&this["set"+t(o[n])](e[o[n]])}s.prototype={getArgs:function(){return this.args},setArgs:function(t){if("[object Array]"!==Object.prototype.toString.call(t))throw new TypeError("Args must be an Array");this.args=t},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(t){if(t instanceof s)this.evalOrigin=t;else{if(!(t instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new s(t)}},toString:function(){var t=this.getFileName()||"",e=this.getLineNumber()||"",n=this.getColumnNumber()||"",r=this.getFunctionName()||"";return this.getIsEval()?t?"[eval] ("+t+":"+e+":"+n+")":"[eval]:"+e+":"+n:r?r+" ("+t+":"+e+":"+n+")":t+":"+e+":"+n}},s.fromString=function(t){var e=t.indexOf("("),n=t.lastIndexOf(")"),r=t.substring(0,e),i=t.substring(e+1,n).split(","),o=t.substring(n+1);if(0===o.indexOf("@"))var a=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(o,""),c=a[1],h=a[2],u=a[3];return new s({functionName:r,args:i||void 0,fileName:c,lineNumber:h||void 0,columnNumber:u||void 0})};for(var a=0;a<n.length;a++)s.prototype["get"+t(n[a])]=e(n[a]),s.prototype["set"+t(n[a])]=function(t){return function(e){this[t]=Boolean(e)}}(n[a]);for(var c=0;c<r.length;c++)s.prototype["get"+t(r[c])]=e(r[c]),s.prototype["set"+t(r[c])]=function(t){return function(e){if(n=e,isNaN(parseFloat(n))||!isFinite(n))throw new TypeError(t+" must be a Number");var n;this[t]=Number(e)}}(r[c]);for(var h=0;h<i.length;h++)s.prototype["get"+t(i[h])]=e(i[h]),s.prototype["set"+t(i[h])]=function(t){return function(e){this[t]=String(e)}}(i[h]);return s}()}),M=m(function(t,e){var n,r,i,o;t.exports=(n=y,r=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/,{parse:function(t){if(void 0!==t.stacktrace||void 0!==t["opera#sourceloc"])return this.parseOpera(t);if(t.stack&&t.stack.match(i))return this.parseV8OrIE(t);if(t.stack)return this.parseFFOrSafari(t);throw new Error("Cannot parse given Error object")},extractLocation:function(t){if(-1===t.indexOf(":"))return[t];var e=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(t.replace(/[()]/g,""));return[e[1],e[2]||void 0,e[3]||void 0]},parseV8OrIE:function(t){return t.stack.split("\n").filter(function(t){return!!t.match(i)},this).map(function(t){t.indexOf("(eval ")>-1&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(\),.*$)/g,""));var e=t.replace(/^\s+/,"").replace(/\(eval code/g,"("),r=e.match(/ (\((.+):(\d+):(\d+)\)$)/),i=(e=r?e.replace(r[0],""):e).split(/\s+/).slice(1),o=this.extractLocation(r?r[1]:i.pop()),s=i.join(" ")||void 0,a=["eval","<anonymous>"].indexOf(o[0])>-1?void 0:o[0];return new n({functionName:s,fileName:a,lineNumber:o[1],columnNumber:o[2],source:t})},this)},parseFFOrSafari:function(t){return t.stack.split("\n").filter(function(t){return!t.match(o)},this).map(function(t){if(t.indexOf(" > eval")>-1&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===t.indexOf("@")&&-1===t.indexOf(":"))return new n({functionName:t});var e=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=t.match(e),i=r&&r[1]?r[1]:void 0,o=this.extractLocation(t.replace(e,""));return new n({functionName:i,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:t})},this)},parseOpera:function(t){return!t.stacktrace||t.message.indexOf("\n")>-1&&t.message.split("\n").length>t.stacktrace.split("\n").length?this.parseOpera9(t):t.stack?this.parseOpera11(t):this.parseOpera10(t)},parseOpera9:function(t){for(var e=/Line (\d+).*script (?:in )?(\S+)/i,r=t.message.split("\n"),i=[],o=2,s=r.length;o<s;o+=2){var a=e.exec(r[o]);a&&i.push(new n({fileName:a[2],lineNumber:a[1],source:r[o]}))}return i},parseOpera10:function(t){for(var e=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=t.stacktrace.split("\n"),i=[],o=0,s=r.length;o<s;o+=2){var a=e.exec(r[o]);a&&i.push(new n({functionName:a[3]||void 0,fileName:a[2],lineNumber:a[1],source:r[o]}))}return i},parseOpera11:function(t){return t.stack.split("\n").filter(function(t){return!!t.match(r)&&!t.match(/^Error created at/)},this).map(function(t){var e,r=t.split("@"),i=this.extractLocation(r.pop()),o=r.shift()||"",s=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;o.match(/\(([^)]*)\)/)&&(e=o.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var a=void 0===e||"[arguments not available]"===e?void 0:e.split(",");return new n({functionName:s,args:a,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:t})},this)}})}),x=b;function b(t,e){this.x=t,this.y=e}b.prototype={clone:function(){return new b(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-r*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},b.convert=function(t){return t instanceof b?t:Array.isArray(t)?new b(t[0],t[1]):t};const w=globalThis.maplibregl;if(void 0!==w){w.Map.prototype.cachedPanTo=function(t,e){const n=Object.assign({},e,{type:"pan",center:t},this._context(e));if(this._precache(n),e.run)return this.panTo(point,e)},w.Map.prototype.cachedZoomTo=function(t,e){const n=Object.assign({},e,{type:"zoom",zoom:t},this._context(e));if(this._precache(n),e.run)return this.zoomTo(t,e)},w.Map.prototype.cachedJumpTo=function(t){const e=Object.assign({},t,{type:"jump"},this._context(t));if(this._precache(e),t.run)return this.jumpTo(e)},w.Map.prototype.cachedEaseTo=function(t){const e=Object.assign({},t,{type:"ease"},this._context(t));if(this._precache(e),t.run)return this.easeTo(e)},w.Map.prototype.cachedFlyTo=function(t){t.type="fly";const e=Object.assign({},t,{type:"fly"},this._context(t));if(this._precache(e),t.run)return this.flyTo(e)};const t=function(t){const e=Object.entries(this.getStyle().sources).filter(t=>["vector","raster"].indexOf(t[1].type)>-1&&(void 0!==t[1].url||void 0!==t[1].tiles)).map(t=>this.getSource(t[0]).tiles[0]),n=[this.getCanvas().width,this.getCanvas().height],r=this.transform.tileSize,i=this.getCenter();let o=Math.min(this.getZoom(),t.zoom);if("fly"==t.type){const e=x.convert(t.offset||[0,0]);let n=this.transform.centerPoint.add(e);const r=this.transform.pointLocation(n),i=new w.LngLat(...t.center);this._normalizeCenter(i);const s=this.transform.project(r),a=this.transform.project(i).sub(s),c=t.curve||1.42,h=2*c*c*a.mag(),u=this.getZoom()+this.transform.scaleZoom(1/h);o=Math.floor(Math.max(Math.min(o+u,t.minZoom||o+u),0))}return{sources:e,dimensions:n,tilesize:r,startCenter:[i.lng,i.lat],startZoom:this.getZoom(),zmin:o}};w.Map.prototype._context=t,w.Map.prototype._precache=function(t){if(window===self&&null==this.precache_worker){const e=`\n            importScripts('${M.parse(new Error("not an actual error!"))[0].fileName}');\n            let controller;\n            let signal;\n            onmessage = function (o){\n                if (controller !== undefined && controller.signal !== undefined && !controller.signal.aborted){\n                    controller.abort();               \n                }\n                if (o.data.abort){\n                    postMessage({t: Date.now(), e: true});\n                    return;\n                }\n                controller = new AbortController();\n                signal = controller.signal;     \n                let _func = ${_.toString()};\n                _func.apply(null, [o.data]);\n            }`,n=URL.createObjectURL(new Blob([e],{type:"text/javascript"}));this.precache_worker=new Worker(n),this.precache_worker.onmessage=e=>{this.precache_worker.time1=e.data.t,t.debug&&console.log(`Precaching time: ${this.precache_worker.time1-this.precache_worker.time0}ms`)}}delete this.precache_worker.time1,this.once("moveend",e=>{null==this.precache_worker.time1?(this.precache_worker.postMessage({abort:!0}),t.debug&&console.log("🔶 Movement has finished before preloading")):t.debug&&console.log(`🔚 Movement ends ${this.precache_worker.time1?Date.now()-this.precache_worker.time1:void 0} ms after precaching`)}),this.precache_worker.time0=Date.now(),this.precache_worker.postMessage(t)}}const _=t=>{const e=v(t.center,t.zoom,t.dimensions,t.tilesize),n=(t,e)=>{const n=p.pointToTile(t[0],t[1],e),r=p.pointToTile(t[2],t[3],e),i=[];for(let t=n[0]-1;t<r[0]+2;t++)for(let o=r[1]-1;o<n[1]+2;o++)i.push([t,o,e]);return i},r=(t,e,n)=>{const[r,i]=p.pointToTile(t[0],t[1],n),[o,s]=p.pointToTile(e[0],e[1],n),[a,c]=[Math.abs(o-r),Math.abs(s-i)],[h,u]=[r<o?1:-1,i<s?1:-1];let l=(a>c?a:-c)/2,[f,m]=[r,i],g=[];for(;f!==o||m!==s;){g.push([f,m,n],...p.getSiblings([f,m,n]));let t=l;t>-a&&(l-=c,f+=h),t<c&&(l+=a,m+=u)}return g.push([o,s,n],...p.getSiblings([o,s,n])),[...new Set(g)]};let i,o=[...r(t.startCenter,t.center,t.zmin)];"fly"==t.type&&o.push(...r(t.startCenter,t.center,t.zmin-1),...r(t.startCenter,t.center,t.zmin+1));for(let r=t.zoom;r>t.zmin-1;r--){const t=n(e,r);o.push(...t),i=t.length}o=[...new Set(o)],urls=o.map(e=>t.sources.map(t=>t.replace("{x}",e[0]).replace("{y}",e[1]).replace("{z}",e[2]))).flat(),Promise.all(urls.map(t=>fetch(t,{signal}))).then(e=>{t.debug&&console.log(`Estimated gain: ${Math.round(900*i/6)}ms`),t.debug&&console.log(`Prefetched ${urls.length} tiles at zoom levels [${t.zmin} - ${t.zoom}]`),postMessage({t:Date.now(),e:!1})}).catch(e=>{t.debug&&"AbortError"!==e.name&&console.log("🔴 Precache error")})};globalThis.tilebelt=f,globalThis.bounds=v;
//# sourceMappingURL=maplibre-preload.modern.js.map
